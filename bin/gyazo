#!/usr/bin/env ruby
$:.unshift File.expand_path '../lib', File.dirname(__FILE__)

require 'rubygems'
require 'gyazo'
require 'launchy'

raw = ARGV.include? "-raw"
upload_files = ARGV.reject{|arg| arg =~ /^\-+raw$/ }

if upload_files.empty?
  STDERR.puts "gyazo [file1, file2 ...]"
  STDERR.puts "gyazo -raw [file1, file2 ...]  # raw upload"
  exit 1
end

g = Gyazo::Client.new


upload_files.each do |file|
  next unless File.exists? file
  url = g.upload file, :raw => raw
  puts url
  Launchy.open url rescue
  sleep 1
end
